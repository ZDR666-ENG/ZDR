<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç˜¦èº«å°ä¼™ä¼´ - ä¸€èµ·å‡è‚¥æ›´æœ‰è¶£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        /* ä¸»é¡µé¢æ ·å¼ */
        .main-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            margin: 5px;
            background: #f0f0f0;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ‰“å¡å¡ç‰‡æ ·å¼ */
        .checkin-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .checkin-card h3 {
            margin-bottom: 15px;
        }

        .checkin-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .checkin-btn {
            padding: 10px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkin-btn:hover {
            background: white;
            color: #f5576c;
        }

        .checkin-btn.completed {
            background: white;
            color: #f5576c;
        }

        /* é£Ÿè°±å¡ç‰‡æ ·å¼ */
        .recipe-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .recipe-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .recipe-card .author {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .add-recipe-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .add-recipe-form input, .add-recipe-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            background: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }

        /* ç¤¾åŒºäº’åŠ¨æ ·å¼ */
        .post-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .post-card .author {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .post-card .content {
            margin-bottom: 10px;
        }

        .post-card .actions {
            display: flex;
            gap: 15px;
        }

        .post-card .actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }

        .post-card .actions button:hover {
            color: #667eea;
        }

        /* æ’è¡Œæ¦œæ ·å¼ */
        .leaderboard {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
        }

        .rank-1 { border-left: 5px solid #ffd700; }
        .rank-2 { border-left: 5px solid #c0c0c0; }
        .rank-3 { border-left: 5px solid #cd7f32; }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-container {
                padding: 20px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .checkin-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h2>ğŸ¯ ç˜¦èº«å°ä¼™ä¼´</h2>
            <div class="input-group">
                <input type="text" id="username" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="è®¾ç½®å¯†ç ">
            </div>
            <button class="btn" onclick="login()">å¼€å§‹ç˜¦èº«ä¹‹æ—…</button>
        </div>
    </div>

    <!-- ä¸»é¡µé¢ -->
    <div id="mainPage" class="container">
        <div class="main-container">
            <div class="header">
                <h1>ğŸŒŸ ç˜¦èº«å°ä¼™ä¼´</h1>
                <p>æ¬¢è¿ <span id="currentUser"></span>ï¼è®©æˆ‘ä»¬ä¸€èµ·å¥åº·ç˜¦èº«ï¼</p>
                <button onclick="logout()" style="position: absolute; right: 30px; top: 30px; background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">é€€å‡º</button>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">ğŸ“Š ä»Šæ—¥æ‰“å¡</button>
                <button class="nav-tab" onclick="showSection('recipes')">ğŸ¥— å…±äº«é£Ÿè°±</button>
                <button class="nav-tab" onclick="showSection('community')">ğŸ’¬ ç˜¦èº«ç¤¾åŒº</button>
                <button class="nav-tab" onclick="showSection('progress')">ğŸ“ˆ æˆ‘çš„è¿›åº¦</button>
                <button class="nav-tab" onclick="showSection('leaderboard')">ğŸ† ç˜¦èº«æ’è¡Œæ¦œ</button>
            </div>

            <!-- ä»Šæ—¥æ‰“å¡ -->
            <div id="dashboard" class="content-section active">
                <div class="checkin-card">
                    <h3>ğŸ’ª ä»Šæ—¥æ‰“å¡</h3>
                    <div class="checkin-buttons">
                        <button class="checkin-btn" id="dietBtn" onclick="checkin('diet')">é¥®é£Ÿæ‰“å¡</button>
                        <button class="checkin-btn" id="waterBtn" onclick="checkin('water')">å–æ°´æ‰“å¡</button>
                        <button class="checkin-btn" id="exerciseBtn" onclick="checkin('exercise')">è¿åŠ¨æ‰“å¡</button>
                        <button class="checkin-btn" id="weightBtn" onclick="checkin('weight')">è®°å½•ä½“é‡</button>
                    </div>
                </div>

                <div id="checkinStatus">
                    <h3>ä»Šæ—¥å®Œæˆæƒ…å†µ</h3>
                    <div id="todayProgress"></div>
                </div>

                <div id="friendUpdates" style="margin-top: 30px;">
                    <h3>å¥½å‹åŠ¨æ€</h3>
                    <div id="updatesList"></div>
                </div>
            </div>

            <!-- å…±äº«é£Ÿè°± -->
            <div id="recipes" class="content-section">
                <div class="add-recipe-form">
                    <h3>åˆ†äº«æ–°é£Ÿè°±</h3>
                    <input type="text" id="recipeName" placeholder="é£Ÿè°±åç§°">
                    <textarea id="recipeContent" placeholder="é£Ÿè°±è¯¦æƒ…ï¼ˆé£Ÿæã€åšæ³•ã€çƒ­é‡ç­‰ï¼‰" rows="4"></textarea>
                    <button class="btn" onclick="addRecipe()">åˆ†äº«é£Ÿè°±</button>
                </div>
                <div id="recipesList"></div>
            </div>

            <!-- ç˜¦èº«ç¤¾åŒº -->
            <div id="community" class="content-section">
                <div class="add-recipe-form">
                    <h3>å‘å¸ƒåŠ¨æ€</h3>
                    <textarea id="postContent" placeholder="åˆ†äº«ä½ çš„ç˜¦èº«å¿ƒå¾—ã€å›°éš¾æˆ–æˆå°±..." rows="3"></textarea>
                    <button class="btn" onclick="addPost()">å‘å¸ƒ</button>
                </div>
                <div id="postsList"></div>
            </div>

            <!-- æˆ‘çš„è¿›åº¦ -->
            <div id="progress" class="content-section">
                <h3>æˆ‘çš„ç˜¦èº«è¿›åº¦</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h4>ç›®æ ‡ä½“é‡: <span id="goalWeight">60</span>kg</h4>
                    <h4>å½“å‰ä½“é‡: <span id="currentWeightDisplay">65</span>kg</h4>
                    <h4>è¿˜éœ€åŠªåŠ›: <span id="remaining">5</span>kg</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 50%"></div>
                    </div>
                </div>
                <div id="weightChart" style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                    <h4>ä½“é‡å˜åŒ–è¶‹åŠ¿</h4>
                    <canvas id="weightCanvas" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- ç˜¦èº«æ’è¡Œæ¦œ -->
            <div id="leaderboard" class="content-section">
                <h3>ğŸ† ç˜¦èº«æ’è¡Œæ¦œ</h3>
                <div class="leaderboard">
                    <div id="leaderboardList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('weightLossUsers')) || {};
        let recipes = JSON.parse(localStorage.getItem('weightLossRecipes')) || [];
        let posts = JSON.parse(localStorage.getItem('weightLossPosts')) || [];
        let leaderboard = JSON.parse(localStorage.getItem('weightLossLeaderboard')) || [];

        // ç™»å½•åŠŸèƒ½
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥æ˜µç§°å’Œå¯†ç ï¼');
                return;
            }

            currentUser = username;
            
            if (!users[username]) {
                users[username] = {
                    password: password,
                    weight: 65,
                    goalWeight: 60,
                    checkins: {},
                    recipes: [],
                    posts: [],
                    weightHistory: [{date: new Date().toISOString().split('T')[0], weight: 65}]
                };
            } else if (users[username].password !== password) {
                alert('å¯†ç é”™è¯¯ï¼');
                return;
            }

            localStorage.setItem('weightLossUsers', JSON.stringify(users));
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('currentUser').textContent = username;
            
            loadDashboard();
            loadRecipes();
            loadCommunity();
            loadProgress();
            loadLeaderboard();
        }

        // é€€å‡ºç™»å½•
        function logout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // æ˜¾ç¤ºä¸åŒæ¿å—
        function showSection(section) {
            const sections = document.querySelectorAll('.content-section');
            const tabs = document.querySelectorAll('.nav-tab');
            
            sections.forEach(s => s.classList.remove('active'));
            tabs.forEach(t => t.classList.remove('active'));
            
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');
        }

        // æ‰“å¡åŠŸèƒ½
        function checkin(type) {
            const today = new Date().toISOString().split('T')[0];
            if (!users[currentUser].checkins[today]) {
                users[currentUser].checkins[today] = {};
            }
            
            users[currentUser].checkins[today][type] = true;
            localStorage.setItem('weightLossUsers', JSON.stringify(users));
            
            const btn = document.getElementById(type + 'Btn');
            btn.classList.add('completed');
            btn.textContent = 'âœ“ ' + btn.textContent;
            
            updateTodayProgress();
            addFriendUpdate(`${currentUser} å®Œæˆäº†${getCheckinName(type)}æ‰“å¡ï¼`);
            
            // æ›´æ–°æ’è¡Œæ¦œ
            updateLeaderboard();
        }

        function getCheckinName(type) {
            const names = {
                'diet': 'é¥®é£Ÿ',
                'water': 'å–æ°´',
                'exercise': 'è¿åŠ¨',
                'weight': 'ä½“é‡'
            };
            return names[type];
        }

        // æ›´æ–°ä»Šæ—¥è¿›åº¦
        function updateTodayProgress() {
            const today = new Date().toISOString().split('T')[0];
            const todayCheckins = users[currentUser].checkins[today] || {};
            const completed = Object.keys(todayCheckins).length;
            const total = 4;
            const percentage = (completed / total * 100).toFixed(0);
            
            document.getElementById('todayProgress').innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%"></div>
                </div>
                <p style="text-align: center; margin-top: 10px;">ä»Šæ—¥å®Œæˆåº¦: ${percentage}% (${completed}/${total})</p>
            `;
        }

        // æ·»åŠ å¥½å‹åŠ¨æ€
        function addFriendUpdate(update) {
            const updates = JSON.parse(localStorage.getItem('weightLossUpdates')) || [];
            updates.unshift({
                user: currentUser,
                content: update,
                time: new Date().toLocaleString()
            });
            localStorage.setItem('weightLossUpdates', JSON.stringify(updates));
            loadFriendUpdates();
        }

        // åŠ è½½å¥½å‹åŠ¨æ€
        function loadFriendUpdates() {
            const updates = JSON.parse(localStorage.getItem('weightLossUpdates')) || [];
            const updatesList = document.getElementById('updatesList');
            
            if (updates.length === 0) {
                updatesList.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— å¥½å‹åŠ¨æ€</p>';
                return;
            }
            
            updatesList.innerHTML = updates.slice(0, 10).map(update => `
                <div class="post-card">
                    <div class="author">${update.user}</div>
                    <div class="content">${update.content}</div>
                    <div style="color: #999; font-size: 12px;">${update.time}</div>
                </div>
            `).join('');
        }

        // æ·»åŠ é£Ÿè°±
        function addRecipe() {
            const name = document.getElementById('recipeName').value.trim();
            const content = document.getElementById('recipeContent').value.trim();
            
            if (!name || !content) {
                alert('è¯·å¡«å†™å®Œæ•´çš„é£Ÿè°±ä¿¡æ¯ï¼');
                return;
            }
            
            const recipe = {
                id: Date.now(),
                name: name,
                content: content,
                author: currentUser,
                time: new Date().toLocaleString(),
                likes: 0
            };
            
            recipes.unshift(recipe);
            users[currentUser].recipes.push(recipe.id);
            localStorage.setItem('weightLossRecipes', JSON.stringify(recipes));
            localStorage.setItem('weightLossUsers', JSON.stringify(users));
            
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeContent').value = '';
            
            loadRecipes();
            addFriendUpdate(`${currentUser} åˆ†äº«äº†ä¸€ä¸ªæ–°é£Ÿè°±ï¼š${name}`);
        }

        // åŠ è½½é£Ÿè°±
        function loadRecipes() {
            const recipesList = document.getElementById('recipesList');
            
            if (recipes.length === 0) {
                recipesList.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— é£Ÿè°±ï¼Œå¿«æ¥åˆ†äº«ç¬¬ä¸€ä¸ªå§ï¼</p>';
                return;
            }
            
            recipesList.innerHTML = recipes.map(recipe => `
                <div class="recipe-card">
                    <h4>${recipe.name}</h4>
                    <div class="author">by ${recipe.author} Â· ${recipe.time}</div>
                    <div>${recipe.content}</div>
                    <div style="margin-top: 10px;">
                        <button onclick="likeRecipe(${recipe.id})" style="background: none; border: none; color: #667eea; cursor: pointer;">
                            ğŸ‘ ${recipe.likes}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ç‚¹èµé£Ÿè°±
        function likeRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (recipe) {
                recipe.likes++;
                localStorage.setItem('weightLossRecipes', JSON.stringify(recipes));
                loadRecipes();
            }
        }

        // å‘å¸ƒåŠ¨æ€
        function addPost() {
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                alert('è¯·è¾“å…¥åŠ¨æ€å†…å®¹ï¼');
                return;
            }
            
            const post = {
                id: Date.now(),
                content: content,
                author: currentUser,
                time: new Date().toLocaleString(),
                likes: 0,
                comments: []
            };
            
            posts.unshift(post);
            users[currentUser].posts.push(post.id);
            localStorage.setItem('weightLossPosts', JSON.stringify(posts));
            localStorage.setItem('weightLossUsers', JSON.stringify(users));
            
            document.getElementById('postContent').value = '';
            
            loadCommunity();
        }

        // åŠ è½½ç¤¾åŒº
        function loadCommunity() {
            const postsList = document.getElementById('postsList');
            
            if (posts.length === 0) {
                postsList.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— åŠ¨æ€ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡å§ï¼</p>';
                return;
            }
            
            postsList.innerHTML = posts.map(post => `
                <div class="post-card">
                    <div class="author">${post.author}</div>
                    <div class="content">${post.content}</div>
                    <div class="actions">
                        <button onclick="likePost(${post.id})">ğŸ‘ ${post.likes}</button>
                        <button onclick="commentPost(${post.id})">ğŸ’¬ ${post.comments.length}</button>
                        <span style="color: #999; font-size: 12px;">${post.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // ç‚¹èµåŠ¨æ€
        function likePost(id) {
            const post = posts.find(p => p.id === id);
            if (post) {
                post.likes++;
                localStorage.setItem('weightLossPosts', JSON.stringify(posts));
                loadCommunity();
            }
        }

        // è¯„è®ºåŠ¨æ€
        function commentPost(id) {
            const comment = prompt('è¯·è¾“å…¥ä½ çš„è¯„è®ºï¼š');
            if (comment) {
                const post = posts.find(p => p.id === id);
                if (post) {
                    post.comments.push({
                        user: currentUser,
                        content: comment,
                        time: new Date().toLocaleString()
                    });
                    localStorage.setItem('weightLossPosts', JSON.stringify(posts));
                    loadCommunity();
                }
            }
        }

        // åŠ è½½è¿›åº¦
        function loadProgress() {
            const user = users[currentUser];
            const currentWeight = user.weight;
            const goalWeight = user.goalWeight;
            const remaining = (currentWeight - goalWeight).toFixed(1);
            const progress = ((65 - currentWeight) / (65 - goalWeight) * 100).toFixed(0);
            
            document.getElementById('currentWeightDisplay').textContent = currentWeight;
            document.getElementById('remaining').textContent = remaining;
            document.getElementById('progressFill').style.width = Math.max(0, Math.min(100, progress)) + '%';
            
            // ç»˜åˆ¶ä½“é‡å˜åŒ–å›¾
            drawWeightChart();
        }

        // ç»˜åˆ¶ä½“é‡å˜åŒ–å›¾
        function drawWeightChart() {
            const canvas = document.getElementById('weightCanvas');
            const ctx = canvas.getContext('2d');
            const history = users[currentUser].weightHistory;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (history.length < 2) {
                ctx.fillStyle = '#999';
                ctx.font = '14px Arial';
                ctx.fillText('æ•°æ®ä¸è¶³ï¼Œè¯·å…ˆè®°å½•ä½“é‡', 10, 50);
                return;
            }
            
            // ç®€å•çš„æŠ˜çº¿å›¾
            const maxWeight = Math.max(...history.map(h => h.weight));
            const minWeight = Math.min(...history.map(h => h.weight));
            const range = maxWeight - minWeight || 1;
            
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            history.forEach((point, index) => {
                const x = (index / (history.length - 1)) * (canvas.width - 40) + 20;
                const y = canvas.height - 20 - ((point.weight - minWeight) / range) * (canvas.height - 40);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.stroke();
            
            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#999';
            ctx.font = '12px Arial';
            ctx.fillText(minWeight + 'kg', 5, 20);
            ctx.fillText(maxWeight + 'kg', 5, canvas.height - 10);
        }

        // æ›´æ–°æ’è¡Œæ¦œ
        function updateLeaderboard() {
            const userStats = [];
            
            Object.keys(users).forEach(username => {
                const user = users[username];
                const today = new Date().toISOString().split('T')[0];
                const todayCheckins = user.checkins[today] || {};
                const checkinCount = Object.keys(user.checkins).length;
                const totalCheckins = Object.values(user.checkins).reduce((sum, day) => sum + Object.keys(day).length, 0);
                
                userStats.push({
                    username: username,
                    checkinCount: checkinCount,
                    totalCheckins: totalCheckins,
                    weightLoss: 65 - user.weight,
                    todayCheckins: Object.keys(todayCheckins).length
                });
            });
            
            // æŒ‰æ€»æ‰“å¡æ¬¡æ•°å’Œå‡é‡æ’åº
            userStats.sort((a, b) => {
                const scoreA = a.totalCheckins * 10 + a.weightLoss * 5;
                const scoreB = b.totalCheckins * 10 + b.weightLoss * 5;
                return scoreB - scoreA;
            });
            
            localStorage.setItem('weightLossLeaderboard', JSON.stringify(userStats));
            loadLeaderboard();
        }

        // åŠ è½½æ’è¡Œæ¦œ
        function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            const leaderboard = JSON.parse(localStorage.getItem('weightLossLeaderboard')) || [];
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— æ•°æ®</p>';
                return;
            }
            
            leaderboardList.innerHTML = leaderboard.map((user, index) => {
                const rankClass = index < 3 ? `rank-${index + 1}` : '';
                const medal = index < 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] : `${index + 1}.`;
                
                return `
                    <div class="leaderboard-item ${rankClass}">
                        <div>
                            <span>${medal} ${user.username}</span>
                            <div style="font-size: 12px; color: #666;">
                                æ‰“å¡${user.checkinCount}å¤© Â· æ€»æ‰“å¡${user.totalCheckins}æ¬¡ Â· å‡é‡${user.weightLoss.toFixed(1)}kg
                            </div>
                        </div>
                        <div style="font-weight: bold; color: #667eea;">
                            ${(user.totalCheckins * 10 + user.weightLoss * 5).toFixed(0)}åˆ†
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½ä»ªè¡¨ç›˜
        function loadDashboard() {
            updateTodayProgress();
            loadFriendUpdates();
            
            // é‡ç½®æ‰“å¡æŒ‰é’®çŠ¶æ€
            const today = new Date().toISOString().split('T')[0];
            const todayCheckins = users[currentUser].checkins[today] || {};
            
            ['diet', 'water', 'exercise', 'weight'].forEach(type => {
                const btn = document.getElementById(type + 'Btn');
                if (todayCheckins[type]) {
                    btn.classList.add('completed');
                    btn.textContent = 'âœ“ ' + btn.textContent.replace('âœ“ ', '');
                } else {
                    btn.classList.remove('completed');
                    btn.textContent = btn.textContent.replace('âœ“ ', '');
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·ç™»å½•
            const savedUser = localStorage.getItem('weightLossCurrentUser');
            if (savedUser && users[savedUser]) {
                currentUser = savedUser;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                document.getElementById('currentUser').textContent = currentUser;
                
                loadDashboard();
                loadRecipes();
                loadCommunity();
                loadProgress();
                loadLeaderboard();
            }
        };

        // ä¿å­˜å½“å‰ç”¨æˆ·
        window.onbeforeunload = function() {
            if (currentUser) {
                localStorage.setItem('weightLossCurrentUser', currentUser);
            }
        };
    </script>
</body>
</html>



